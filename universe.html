<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <title>Universe — BaseX / RushX / RogueX — Archives</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link
    href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700&family=Fira+Code:wght@400;600&display=swap"
    rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root {
      --bg: #07101a;
      --panel: #0b1220;
      --muted: #8fbcd8;
      --accent: #00e6ff;
      --accent-2: #f9627d;
      --card: #071624;
      --mono: 'Fira Code', monospace;
      --title: 'Press Start 2P', cursive;
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: 'Orbitron', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #041018 0%, #081826 100%);
      color: #eaf8ff;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
      padding: 20px;
    }

    /* container */
    .shell {
      max-width: 1200px;
      margin: 0 auto;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.02));
      border-radius: 12px;
      padding: 18px;
      border: 1px solid rgba(0, 230, 255, 0.06);
      box-shadow: 0 6px 30px rgba(0, 0, 0, 0.5);
    }

    .header {
      display: flex;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .brand {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .logo {
      height: 54px;
      width: 54px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), #6af0ff);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #001219;
      font-weight: 700;
      box-shadow: 0 4px 14px rgba(0, 230, 255, 0.08);
      font-family: var(--title);
    }

    .title {
      font-family: var(--title);
      color: var(--accent);
      font-size: 0.9rem;
      letter-spacing: 0.02em;
      text-shadow: 0 2px 8px rgba(0, 230, 255, 0.06);
    }

    .subtitle {
      font-size: 0.78rem;
      color: var(--muted);
    }

    /* tabs */
    .tabs {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .tab {
      padding: 10px 12px;
      background: transparent;
      border: 1px solid rgba(0, 230, 255, 0.06);
      color: var(--muted);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.78rem;
    }

    .tab.active {
      background: linear-gradient(90deg, rgba(0, 230, 255, 0.06), rgba(249, 98, 125, 0.03));
      color: var(--accent);
      box-shadow: 0 6px 18px rgba(0, 230, 255, 0.045);
      border-color: rgba(0, 230, 255, 0.18);
    }

    .content {
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 18px;
      align-items: start;
    }

    @media(max-width:1000px) {
      .content {
        grid-template-columns: 1fr;
      }

      .sidebar {
        order: 2;
      }
    }

    /* main panel */
    .panel {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.00));
      border-radius: 10px;
      padding: 14px;
      border: 1px solid rgba(255, 255, 255, 0.02);
      min-height: 320px;
    }

    h2.section-title {
      font-family: var(--title);
      color: var(--accent);
      font-size: 0.85rem;
      margin: 0 0 8px;
    }

    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.00));
      border-radius: 8px;
      padding: 12px;
      border: 1px solid rgba(255, 255, 255, 0.02);
      margin-bottom: 10px;
      color: #eaf8ff;
    }

    .console {
      background: #000814;
      color: #cfeeff;
      font-family: var(--mono);
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid var(--accent);
      max-height: 400px;
      overflow: auto;
      white-space: pre-wrap;
      font-size: 0.9rem;
      line-height: 1.45;
    }

    .terminal-input {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      align-items: center;
    }

    .terminal-input input {
      flex: 1;
      background: #00121b;
      border: 1px solid rgba(0, 230, 255, 0.06);
      color: var(--accent);
      padding: 8px 10px;
      border-radius: 6px;
      outline: none;
      font-family: var(--mono);
    }

    .terminal-input button {
      background: var(--accent);
      color: #001219;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
    }

    /* sidebar */
    .sidebar {
      position: relative;
    }

    .file-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .file-item {
      padding: 8px 10px;
      border-radius: 8px;
      background: linear-gradient(180deg, #00111a 0%, #00131c 100%);
      border: 1px solid rgba(0, 230, 255, 0.04);
      cursor: pointer;
      color: var(--muted);
      font-weight: 600;
    }

    .file-item:hover {
      background: #001a24;
      color: var(--accent);
      box-shadow: 0 6px 14px rgba(0, 230, 255, 0.03);
    }

    .meta {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 10px;
    }

    .kbd {
      background: #00111a;
      padding: 6px 8px;
      border-radius: 6px;
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--accent);
      border: 1px solid rgba(0, 230, 255, 0.04);
    }

    /* readable lore blocks */
    .lore-block {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.00));
      padding: 12px;
      border-radius: 8px;
      border: 1px dashed rgba(0, 230, 255, 0.04);
      margin-bottom: 10px;
      color: #dff7ff;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    footer {
      margin-top: 14px;
      text-align: center;
      color: var(--muted);
      font-size: 0.8rem;
    }
  </style>
</head>

<body>

  <div class="shell" role="main" aria-label="Universe - BaseX archives">
    <div class="header">
      <div class="brand">
        <div class="logo">BX</div>
        <div>
          <div class="title">X-UNIVERSE — Experimental Archives</div>
          <div class="subtitle">BaseX • RushX • RogueX — codex & devnotes</div>
        </div>
      </div>

      <div>
        <div class="kbd">Sources: lore (texte) + Trello JSON import</div>
      </div>
    </div>

    <div class="tabs" role="tablist" aria-label="Sections">
      <div class="tab active" data-tab="overview" role="tab">Overview</div>
      <div class="tab" data-tab="codex" role="tab">Codex (Lore)</div>
      <div class="tab" data-tab="terminal-tab" role="tab">Terminal</div>
      <div class="tab" data-tab="trello-tab" role="tab">Trello (data)</div>
      <div class="tab" data-tab="help-tab" role="tab">Help</div>
    </div>

    <div class="content">
      <!-- MAIN LEFT -->
      <div class="panel" id="panel-main" aria-live="polite">
        <!-- Overview -->
        <div id="overview" class="view active">
          <h2 class="section-title">Overview</h2>
          <div class="lore-block">
            <strong>Timeline</strong> — BaseX → RushX → RogueX → (BuildX / BaseTacticX).
            <p style="margin-top:8px">
              Le joueur commence sur <strong>BaseX</strong> comme cobaye. S’il devient trop fort ou instable, il est
              envoyé sur <strong>RushX</strong> (dépotoir d’expériences). S'il domine RushX, il peut être sélectionné
              pour <strong>RogueX</strong>. Enfin, ceux qui gagnent la confiance des créateurs accèdent à
              <strong>BuildX</strong> ou <strong>BaseTacticX</strong> et cessent d’être de simples cobayes.
            </p>
          </div>

          <h2 class="section-title">Rapide</h2>
          <div class="card">
            <strong>Univers</strong> — île chaotique, largage en capsule, ruines, mutants biologiques et technologiques.
            (Voir "Codex" pour le texte complet.)
          </div>

          <h2 class="section-title">Méthode</h2>
          <div class="card">
            <ul>
              <li>Design : itératif — prototypes en Phaser / Godot / Love2D, version cible : Godot (modulaire).</li>
              <li>Gameplay : récolte (rapide / précis), crafting via blueprints, sélection dynamique de zones.</li>
              <li>UX : Home screen "Tap to play", clear cache, serveur selector, save local options.</li>
            </ul>
          </div>
        </div>

        <!-- CODEX / LORE -->
        <div id="codex" class="view" style="display:none;">
          <h2 class="section-title">Codex — Lore détaillé</h2>

          <div class="lore-block" id="lore-master">
            <!-- Insert the full, verbatim lore the user provided (kept paragraphs & headings) -->
            Le joueur commence sur BaseX, il est un cobaye. Le joueur devient trop fort / dangereux pour l’expérience,
            il est envoyé sur RushX. Le joueur domine RushX, il lui est proposé d’aller sur RogueX. Le joueur a gagné la
            confiance des créateurs, il peut aller sur BuildX ou bien BaseTacticX. Il n’est plus réellement un cobaye.

            ---

            <strong>Les tests ratés</strong>

            RushX est un dépotoir scientifique. On y jette toutes les expériences considérées comme inutiles, instables
            ou dangereuses. Ce ne sont pas seulement des individus faibles ou imparfaits : ce sont souvent des créations
            qui ne correspondent plus aux attentes du projet global. Les tests ratés sont issus de divers programmes,
            chacun ayant une approche différente de l’évolution humaine :

            1. <strong>Origine des tests ratés</strong>

            - Essais biologiques : tentatives de fusion entre l’humain et l’animal, ou entre l’humain et des matériaux
            organiques synthétiques. Beaucoup développent des mutations inadaptées à la survie, comme des membres
            inutilisables ou des instincts incontrôlables.
            - Sujets de conditionnement mental : individus dont la psyché a été brisée par des tests de manipulation.
            Certains sont devenus ultra-agressifs, d’autres vivent dans un état semi-hypnotique, incapables d’agir sans
            stimulation extérieure.
            - Déchets technologiques : les cobayes qui ont reçu des implants cybernétiques instables. Leur chair rejette
            la technologie, ou inversement, leur corps se transforme en amas de métal non fonctionnel.

            Chaque rejeté arrive sur RushX via des capsules de largage, une méthode brutale qui brise souvent quelques
            os à l’atterrissage. L’île elle-même est un immense terrain d’expérimentation chaotique, couvert de ruines
            de laboratoires, de faune mutée et de vestiges technologiques.

            <strong>Les forts</strong>

            La survie sur RushX ne dépend pas uniquement de la force brute. Les plus forts ne sont pas seulement les
            plus puissants physiquement, mais ceux qui comprennent les règles de cet enfer.

            <em>Classes de forts : Les combattants primitifs & les mutants technologiques</em>

            <strong>Les combattants primitifs</strong>
            - Rejetent la technologie, corps adapté, force et résistance accrues, instinct animal, maîtrise du combat
            instinctif, sociétés tribales éphémères.

            <strong>Les mutants technologiques</strong>
            - Embrassent la techno, implants bricolés, sources d’énergie instables, solitaires, stratégie et adaptation.

            <strong>L'instinct de survie sur RushX</strong>
            - Les faibles ne survivent pas longtemps. La peur des sélections : tout le monde sait que des "élections"
            ont lieu, mais personne ne sait vraiment comment être choisi.

            <strong>Les élus : La sélection pour RogueX</strong>
            - Qui ? Survivants exceptionnels, mutations rares, maîtrise techno, ou tirage aléatoire.
            - Comment ? Observation par drones et capteurs.
            - Rituel : dernier test entre candidats, extraction par capsule/portail lumineux, personne ne revient.

            <strong>Conclusion</strong> : Une île en perpétuelle évolution où la frontière entre humanité et
            monstruosité s’efface. Les scientifiques observent et attendent — leur but reste obscur.
          </div>

          <div class="card">
            <strong>Notes de compréhension</strong>
            <ul>
              <li>RushX est une zone narrative riche — utile pour level design (zones de tests, ruines, points
                d’intérêt).</li>
              <li>Rituel/élection → excellente mécanique PvE/PvP : tournoi d’épreuves, sélection non-prévisible.</li>
              <li>Mettre des "journaux scientifiques" et "logs de laboratoire" sur les cartes pour enrichir le lore en
                jeu.</li>
            </ul>
          </div>
        </div>

        <!-- TERMINAL -->
        <div id="terminal-tab" class="view" style="display:none;">
          <h2 class="section-title">Terminal (commande)</h2>

          <div class="console" id="terminal-output" aria-live="polite">
            Tapez <span class="kbd">help</span> pour la liste des commandes. Exemple : <span class="kbd">basex</span>
            <span class="kbd">rushx</span> <span class="kbd">trello</span> <span class="kbd">details JudgeX</span>
          </div>

          <div class="terminal-input">
            <input id="terminal-input" aria-label="Terminal input" placeholder="> commande (ex: help)" />
            <button id="term-send">Run</button>
          </div>

          <div style="margin-top:10px; color:var(--muted); font-size:0.86rem">
            Commandes simples disponibles: <span class="kbd">help</span>, <span class="kbd">basex</span>, <span
              class="kbd">rushx</span>, <span class="kbd">roguex</span>, <span class="kbd">buildx</span>, <span
              class="kbd">tests</span>, <span class="kbd">forts</span>, <span class="kbd">selection</span>, <span
              class="kbd">trello</span>, <span class="kbd">details &lt;cardName&gt;</span>, <span
              class="kbd">clear</span>.
          </div>
        </div>

        <!-- TRELLO VIEW (detailed dump from JSON) -->
        <div id="trello-tab" class="view" style="display:none;">
          <h2 class="section-title">Trello — Extrait et synthèse</h2>

          <div class="card">
            <strong>Board</strong>: <em>BaseX</em> — (export JSON chargé). Données extraites : lists, cards, actions,
            labels. Source: Trello JSON import. :contentReference[oaicite:1]{index=1}
          </div>

          <div class="card">
            <strong>Cartes clés (extraits)</strong>
            <ul>
              <li><strong>Lore du jeu</strong> — résumé et slogan (Back to basics). Contient : manipulation climatique,
                implants, alliés/ennemis. (card id: e0JomjEF). :contentReference[oaicite:2]{index=2}</li>
              <li><strong>RushX</strong> — card créé 2024-10-15 (sous-projets). (card id: LIrisAUA).
                :contentReference[oaicite:4]{index=4}</li>
              <li><strong>JudgeX</strong> — prototype Reigns-like (card id: HtIbV6ly). Contenu: idée de gameplay "juger
                sujets". :contentReference[oaicite:5]{index=5}</li>
              <li><strong>BuildX / FarmX</strong> — sous-projets listés sur le board (création 2024-09).
                :contentReference[oaicite:6]{index=6}</li>
            </ul>
          </div>

          <div class="card">
            <strong>Choix moteur</strong>: Godot = principal envisagé; prototypes en Phaser / Love2D; autres tests
            (Three.js, PixiJS, Phaser 3 archivés). (extraits actions / archives). :contentReference[oaicite:7]{index=7}
          </div>

          <div class="card">
            <strong>UX & Maquette</strong>: Figma link et notes d'UI (Home screen, server selector, clear cache, social
            icons, minimisation d'interactions). :contentReference[oaicite:8]{index=8}
          </div>
        </div>

        <!-- HELP -->
        <div id="help-tab" class="view" style="display:none;">
          <h2 class="section-title">Help</h2>
          <div class="card">
            <strong>Utilisation</strong>
            <ol>
              <li>Clique sur les <em>tabs</em> pour naviguer.</li>
              <li>Dans <em>Terminal</em>, tape <code>help</code> pour la liste complète. Exemples : <code>basex</code>,
                <code>rushx</code>, <code>details JudgeX</code>.</li>
              <li>Dans <em>Trello</em>, clique sur une carte pour voir le résumé extrait.</li>
            </ol>
          </div>
        </div>
      </div>

      <!-- RIGHT SIDEBAR -->
      <aside class="sidebar">
        <div class="panel">
          <h3 class="section-title">Fichiers & cartes</h3>
          <div class="file-list" id="file-list">
            <!-- dynamically populated -->
          </div>

          <div class="meta">
            <div>Source JSON : <code>basex.json</code> — importé et utilisé pour enrichir le contenu.
              :contentReference[oaicite:9]{index=9}</div>
            <div style="margin-top:8px;"><strong>Quick commands</strong></div>
            <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
              <div class="kbd">basex</div>
              <div class="kbd">rushx</div>
              <div class="kbd">roguex</div>
              <div class="kbd">buildx</div>
              <div class="kbd">trello</div>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <h3 class="section-title">Détails rapide</h3>
          <div class="card">
            <strong>Engine (pros/cons)</strong>
            <ul>
              <li><strong>Godot</strong> — open, lightweight, good for mobile & desktop (recommended).</li>
              <li><strong>Phaser</strong> — fast for web prototypes.</li>
              <li><strong>Love2D</strong> — small experiments (existing prototypes).</li>
            </ul>
          </div>
        </div>
      </aside>
    </div>

    <footer>
      Données intégrées depuis le Trello JSON uploadé :: sources arhives.
    </footer>
  </div>

  <script>
    // -----------------------
    // TAB SWITCH
    // -----------------------
    document.querySelectorAll('.tab').forEach(t => {
      t.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
        t.classList.add('active');
        const target = t.dataset.tab;
        document.querySelectorAll('.view').forEach(v => {
          v.style.display = (v.id === target ? '' : 'none');
          // keep terminal content alive (do not clear)
        });
      });
    });

    // -----------------------
    // Load Trello JSON excerpt (injected by file_search)
    // We'll build a small index of key cards for details command
    // -----------------------

    // (1) Hard-coded extracts from uploaded JSON (sane summary). These strings are built from the JSON you uploaded.
    const trelloIndex = {
      "Lore du jeu": {
        title: "Lore du jeu",
        text: `Slogan EN : Back to basics
Slogan FR :
BaseX n'est pas un archipel d'île ordinaire. Cachée derrière sa beauté luxuriante se cache un laboratoire secret. Le Joueur : Vous êtes un cobaye, enlevé. Expériences: manipulation du climat, implants de surveillance. Alliés/Ennemis: autres cobayes. (source: Trello card 'Lore du jeu')`,
        cite: ":contentReference[oaicite:11]{index=11}"
      },
      "RushX": {
        title: "RushX",
        text: `RushX = dépôt d'expériences rejetées. Arrivée par capsule, ruines de labo, faune mutée, implants défaillants. Les plus forts s'adaptent : deux familles (Combattants primitifs vs Mutants technologiques). (source: Trello / lore)`,
        cite: ":contentReference[oaicite:13]{index=13}"
      },
      "JudgeX": {
        title: "JudgeX",
        text: `Prototype 'JudgeX' inspiré de Reigns — incarnez un roi et prenez des décisions sur vos sujets (inspirations listées). (source: Trello card JudgeX)`,
        cite: ":contentReference[oaicite:14]{index=14}"
      },
      "BuildX": {
        title: "BuildX",
        text: `BuildX: phase où le joueur n'est plus cobaye. Rôle: créer, construire, influencer l'architecture du projet.`,
        cite: ":contentReference[oaicite:15]{index=15}"
      }
    };

    // populate sidebar file list
    const fileList = document.getElementById('file-list');
    Object.keys(trelloIndex).forEach(key => {
      const el = document.createElement('div');
      el.className = 'file-item';
      el.textContent = key;
      el.onclick = () => {
        // open details in codex panel (append)
        showDetails(key);
        // switch to codex/tab
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
        document.querySelector('[data-tab="codex"]').classList.add('active');
        document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
        document.getElementById('codex').style.display = '';
      };
      fileList.appendChild(el);
    });

    // -----------------------
    // Terminal logic (rich)
    // -----------------------
    const out = document.getElementById('terminal-output');
    const input = document.getElementById('terminal-input');
    const sendBtn = document.getElementById('term-send');

    const loreFull = `Le joueur commence sur BaseX, il est un cobaye. Le joueur devient trop fort / dangereux pour l’expérience, il est envoyé sur RushX. Le joueur domine RushX, il lui est proposé d’aller sur RogueX. Le joueur a gagné la confiance des créateurs, il peut aller sur BuildX ou bien BaseTacticX. Il n’est plus réellement un cobaye.

Les tests ratés :
RushX est un dépotoir scientifique. On y jette toutes les expériences considérées comme inutiles, instables ou dangereuses... (texte complet dans le Codex).`;

    // command handlers
    const commands = {
      help: () => (
        `COMMANDES:
help
basex      -> Résumé & design notes de BaseX
rushx      -> Description complète de RushX (tests ratés, classes)
roguex     -> Info sur RogueX (sélection)
buildx     -> BuildX / BaseTacticX - fin du cycle
tests      -> Détails tests ratés (origines / implants / conditionnement)
forts      -> Classes dominantes
selection  -> Mécanique d'election pour RogueX
trello     -> Liste des cartes extraites
details <name> -> Détails sur une carte (ex: details 'JudgeX')
clear      -> Vider le terminal`
      ),
      basex: () => (
        `BASEX — Design notes:
- Joueur = cobaye, environnement = laboratoire à ciel ouvert.
- Mécaniques: récolte (rapide / précis), crafting (blueprints/fragments), gestion d'instances (archipels).
- UX: Home screen "Tap to play", clear cache, serveur selector (tri par pays).
- Engine notes: prototypes en Phaser & Love2D, version cible : Godot.`
      ),
      rushx: () => (
        `RUSHX — DEPOTOIR (détails):
- Arrivée par capsule (atterrissage brutal).
- Ruines de labs, faune mutée, vestiges techno.
- Tests ratés: fusions biologiques, conditionnement mental, implants rejetés.
- Sociétés: combattants primitifs (tribus) vs mutants technologiques (bricolage cybernétique).
- Éléments de level design: zones d'ejection, camps tribaux, carcasses techno.`
      ),
      roguex: () => (
        `ROGUEX — L'INCONNU
- Île plus cruelle, mystérieuse.
- Sélection par drones, ritual final.
- Transport par capsule/portail lumineux = extraction.
- Aucun retours documentés; fin du cycle expérimentale.`
      ),
      buildx: () => (
        `BUILDX / BASETACTICX
- Statut: plus créateur que cobaye.
- Rôles: architecte, constructeur, stratège.
- Idées: outils de build (construction player-driven), tactique multi-base.`
      ),
      tests: () => (
        `TESTS RATÉS — ORIGINES
- Essais biologiques: hybrides inadaptés.
- Conditionnement mental: sujets brisés.
- Déchets techno: implants rejetés, chair/métal hybrides.`
      ),
      forts: () => (
        `LES FORTS — CLASSES
- Combattants primitifs: force brute, tribus, adaptatifs.
- Mutants technologiques: implants, énergie instable, solitaires.`
      ),
      selection: () => (
        `SELECTION POUR ROGUEX
- Observation continue par drones.
- Critères: survie exceptionnelle, mutation rare, maîtrise techno, ou aléatoire.
- Rituel: ultime épreuve vs autres candidats.`
      ),
      trello: () => (
        `TRELLO — CARTES EXTRACTÉES:
- Lore du jeu (slogan + objectifs).
- RushX, JudgeX, BuildX, FarmX.
Pour plus de détails: details <cardName> (ex: details "JudgeX")`
      ),
      // details handler is special below
      clear: () => {
        out.innerText = '';
      }
    };

    function appendOut(text) {
      out.innerText += "\n" + text;
      out.scrollTop = out.scrollHeight;
    }

    function runCommand(raw) {
      if (!raw) return;
      const parts = raw.trim().split(/\s+/);
      const key = parts[0].toLowerCase();
      if (key === 'details') {
        const name = raw.trim().slice(8).trim();
        if (!name) { appendOut("Usage: details <cardName>"); return; }
        if (trelloIndex[name]) {
          appendOut("=== " + trelloIndex[name].title + " ===\n" + trelloIndex[name].text + "\n" + trelloIndex[name].cite);
        } else {
          appendOut("Carte non trouvée: " + name + ". Tape 'trello' pour la liste.");
        }
        return;
      }
      if (commands[key]) {
        const res = commands[key];
        if (typeof res === 'function') {
          const outText = res();
          if (outText) appendOut(outText);
        } else {
          appendOut(res);
        }
      } else {
        appendOut("Commande inconnue. Tape 'help'.");
      }
    }

    sendBtn.addEventListener('click', () => {
      runCommand(input.value);
      input.value = '';
    });
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { runCommand(input.value); input.value = ''; }
    });

    // Initialize terminal with help prompt
    appendOut("Terminal Ready. Tape 'help' pour démarrer.");

    // -----------------------
    // Utility: show details in Codex
    // -----------------------
    function showDetails(name) {
      const block = document.getElementById('lore-master');
      const item = trelloIndex[name];
      if (!item) return;
      // append a focused block but keep original lore
      const el = document.createElement('div');
      el.className = 'lore-block';
      el.innerHTML = `<strong>${item.title}</strong><br/><pre style="white-space:pre-wrap; font-family:${getComputedStyle(document.body).fontFamily};">${item.text}</pre><div style="font-size:0.8rem;margin-top:8px">${item.cite}</div>`;
      // insert after main lore
      block.parentNode.insertBefore(el, block.nextSibling);
      // scroll into view
      el.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // Expose showDetails globally for file sidebar
    window.showDetails = showDetails;

  </script>

  <!-- Bootstrap JS (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>